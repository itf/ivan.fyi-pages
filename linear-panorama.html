<!doctype html><html lang=en-US><head><script integrity=sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1 src=/js/theme.min.js></script><link href="/abridge.css?h=f13d908213237f414e8a" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><script src="/js/abridge.min.js?h=7a008ae54f397de4791e" defer integrity=sha384-jWwR5syXn2tklQhfP11jqm8HMndEVkXtIwiozHBykMgdpgb7hy3apk7Zaj8t7ekR></script><meta content=/ name=base><link title="Ivan.fyi Atom/RSS Feed" href=/atom.xml rel=alternate type=application/atom+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Linear Panorama | Ivan.fyi</title><meta content="Ivan Tadeu Ferreira Antunes Filho" name=author><meta content=Ivan.fyi name=copyright><meta content="Ivan Tadeu Ferreira Antunes Filho, software engineer in Cambridge, Massachussets, Boston Area" name=description><link href=/linear-panorama.html rel=canonical><meta content="Ivan Tadeu Ferreira Antunes Filho, Ivan Antunes Filho, Software Engineer, Backend, Rust, Scala, Elisp" name=keywords><meta content=/linear-panorama.html property=og:url><meta content=/linear-panorama.html name=twitter:url><meta content="Ivan Tadeu Ferreira Antunes Filho, software engineer in Cambridge, Massachussets, Boston Area" property=og:description><meta content="Ivan Tadeu Ferreira Antunes Filho, software engineer in Cambridge, Massachussets, Boston Area" name=twitter:description><meta content="Linear Panorama | Ivan.fyi" property=og:title><meta content="Linear Panorama | Ivan.fyi" name=twitter:title><meta content=summary name=twitter:card><meta content=Ivan.fyi property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2020-07-26 property=og:updated_time><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><meta content=#333333 name=theme-color><meta content=#333333 name=msapplication-TileColor><link href=/manifest.json rel=manifest><link color=#ff9900 href=/safari-pinned-tab.svg rel=mask-icon><link href=/favicon.svg rel=icon type=image/svg+xml><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon sizes=16x16 type=image/png><noscript><link href=/nojs.css rel=stylesheet></noscript><body><header><nav><div><h1><a href=/>Ivan.fyi</a></h1></div><div><a href=/about.html> About </a><a href=/archive/> Archive </a><a href=/blog/> Blog </a><a href=/portfolio.html> Portfolio </a><a href=/resume.html> Resume </a><i class="js svgs adjust" id=mode type=reset></i></div><div><form autocomplete=off class=js id=searchbox name=goSearch><div class=searchd><input id=searchinput placeholder=Search title=Search><button class=si title=Search>âŒ•</button></div><div class=results><div id=suggestions></div></div></form></div></nav><hr></header><main><article><h1><a href=/linear-panorama.html>Linear Panorama</a></h1><span class=s95>December 13, 2015<span class=hpad> </span> Updated: July 26, 2020<span class=hpad> </span> #<a href=/archive/#blog>blog</a> </span><h1 id=Summary:>Summary:</h1><p>Photographing linear panoramas of murals, in a place with poor light conditions, and short distance to the wall.<h1 id=Intro>Intro</h1><p>Photographing the murals in my dorm is a really challenging task. The distance between the walls in the corridor is between 1.5m to 1.7m and the height of the murals is approximately 2m.<p>Besides this, I don't have any special device to illuminate the walls, besides a simple octopus floor lamp with yellowish incandescent lights.<p>Given these constrains I photographed the murals, and made the following linear panoramas (click for full size) <a href=http://slugwiki.mit.edu/images/5/5e/BS.jpg><img alt=img src=http://slugwiki.mit.edu/images/thumb/5/5e/BS.jpg/798px-BS.jpg></a><p><a href=http://slugwiki.mit.edu/images/5/5b/BC.jpg><img alt=img src=http://slugwiki.mit.edu/images/thumb/5/5b/BC.jpg/800px-BC.jpg></a><h1 id=Hardware>Hardware</h1><ul><li>Canon T2i with <a href=http://www.magiclantern.fm/><em>Magic Lantern</em></a> installed<li>Opteka 6.5mm (Also known as Samyang 8mm, it is the same lens sold by a different company)<li>Octopus floor lamp (any floor lamp would work)<li>Tripod (set to around 1m)</ul><h1 id=Software>Software</h1><ul><li>Enfuse<li>Macrofusion<li>Hugin</ul><h1 id=Work_Flow>Work Flow</h1><h2 id=Calibrate_the_Lens.>Calibrate the Lens.</h2><p>If your lens are not calibrated, this should be the first step, if not, skip this session. At first, take a picture of a mural in a way that there are many clear straight lines in the image. Load the image in Hugin. The follow the <a href=http://hugin.sourceforge.net/tutorials/calibration/en.shtml><em>instruction on Hugin to calibrate your lens</em></a>. Instead of using a diagonal line, which might be hard to find, you can use multiple horizontal and vertical lines. However, do not choose horizontal line on the options.<p>If you are using a non standard lens, such as the Samyang 8mm, it is sometimes better to calibrate the lens for the approximate distance that you are gonna take the pictures from.<h2 id=Taking_the_pictures.>Taking the pictures.</h2><p>Set your tripod to be about half of the right of the wall your are photographing (in case it is very near you). If it is farther, or you are not using fish-eye lens this won't affect you much.<p>Set your camera to fully manual mode, set the ISO to the lowest setting (in order to minimize noise), set the focus to manual mode, and also set the white balance to manual mode. It doesn't matter what setting you choose for the white balance.<p>Take multiple pictures, moving the position of the lights between each picture, but do not move the camera. This will assure you that you have the whole scene well illuminated. Besides this, by having your light coming from multiple directions, the end result will have even light, which considerably improves the quality of the image (It makes it look like a scanner)<p>In order to not move the camera, you should use a shutter cable, or using the <a href=http://wiki.magiclantern.fm/userguide><em>LCDsensor Remote</em></a> shoot on shooting preferences of Magic Lantern, if you use a canon dlsr.<p>[<img alt=img src=/./jpg/mural_1.jpg>)<p>[<img alt=img src=/./jpg/mural_2.jpg>)<p>[<img alt=img src=/./jpg/mural_3.jpg>)<h2 id=Fusing_the_images>Fusing the images</h2><p>:CUSTOM_ID: fusing-the-images<p>To fuse the images, you should use <a href=http://wiki.panotools.org/Enfuse>Enfuse</a>. Enfuse is a command line tool for exposure fusing (it can also )<p>In order to better enfuse the pictures I recommend <a href=http://sourceforge.net/projects/macrofusion/><em>Macrofusion</em></a>. Macrofusion is a fast, simple and responsive GUI for Enfuse. Macrofusion makes it easy to choose the weights of exposure, contrast and saturation when fusing the images.<p><a href=/./jpg/mural_enfused.jpg><img title="Mural enfused " alt=img src=/./jpg/mural_enfused.jpg></a>)<h2 id=Straightening_the_images.>Straightening the images.</h2><p>Open the image in Hugin, and load the lens configuration for your lens.<p>Choose a rectilinear projection in Hugin's fast preview window.<p>[<img alt=img src=/./png/hugin_options.png>)<p>This should have straightened up the image. But there should still be perspective problems. Set the horizon and vertical lines in the control points tab and optimize the lens parameters. A full tutorial can be seen on <a href=http://hugin.sourceforge.net/tutorials/perspective/en.shtml><em>Hugin's SourceForge page</em></a><p>Most of the times, Hugin white balance correction in the preview window is enough to fix the image colors. And you just need to stitch the image.<p><a href=/./jpg/mural_final.jpg><img title="Mural final " alt=img src=/./jpg/mural_final.jpg></a>)<h2 id=Taking_the_other_pictures>Taking the other pictures</h2><p>Move the camera to a new position and leave some overlap between the images. It doesn't matter how much overlap you are leaving between the images, in general, what matters is that the images overlap in a line that can contain small errors.<h2 id=Stitching>Stitching</h2><p>The images of the linear panorama should be added one at a time, therefore, you should start with a image that would be in the middle and then move to the corners. Since this is a tutorial I will stitch only 2 images.<p><a href=/./jpg/mural2_final.jpg><img title="Second Mural " alt=img src=/./jpg/mural2_final.jpg></a>)<p>Load both of the images in Hugin, choosing the type of lens to be rectilinear and choose some small value for the focal length, such as 10mm.<p>Set the control points between the images (you can also add lines) and choose custom parameters for the geometric optimization. You should probably set them by hand.<p><a href=/./png/hugin_options2.png><img title="Hugin Rectilinear " alt=img src=/./png/hugin_options2.png></a>)<p>All but one picture parameters should be constant, because we are always adding one image at a time. For the picture that you are optimizing, you should optimize X, Y and HFOV. Since the pictures are already straight, you shouldn't need to optimize roll.<p>If this optimization is not enough, you can optimize for other parameters, but it is usually not necessary.<p>If there are areas between the images that don't match very well in their intersection, it is generally better to add a mas in order to use the result from a single image.<p>Choose custom parameters for photometric optimization. Again, always change only one image at a time. The parameters that you should optimize are EV, Er and Eb. Optimizing the lens parameters usually result in poor blending for linear panoramas.<h2 id=Adding_masks>Adding masks</h2><p>If the images don't perfectly match on top of each other, you have 2 options:<ul><li>Try to optimize other lens parameters<li>Add masks to include certain parts of an image or remove it from others.</ul><p>Generally adding masks is faster and results in fewer problems.<p>You should also use masks to force Hugin to choose the image that has the best resolution for areas where the details are important.<h2 id=Stitching-1>Stitching</h2><p>After you've added all the images it is time to stitch. If you are stitching to JPG, you should keep the canvas size's dimensions below 2<sup>32</sup>-1.<p>Choose exposure fused from any arrangement, click in calculate optimal size if you simply want the largest resolution possible, and stitch!<p>[<img alt=img src=/./jpg/mural_stitched.jpg>) <small> Mural stitched using only 2 control points</small><p>Congratulations! You've finished your linear panorama.<h2 id=Common_Problems>Common Problems</h2><p>The horizon might start to bend. In order to fix this, create a horizon line accross pictures, by adding control points for the horizon line across different images.<nav><div><a href=/led-panel.html>â€¹ Led Panel</a></div><div><a href=/college-essays-reblog.html> College essays reblog â€º</a></div></nav></article></main><footer><hr><div class=c><nav><div><a title="Ivan.fyi Atom/RSS Feed" href=/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="Ivan.fyi Atom/RSS Feed" type=Button></i></a><a class="js m-protected" href=#aXRhZGV1ZmFAZ21haWwuY29t target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://www.linkedin.com/in/ivan-tadeu-ferreira-antunes-filho-8b2b0950/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://www.researchgate.net/profile/Ivan-Tadeu-Ferreira-Antunes-Filho/ target=_blank title=ResearchGate><i class="svg researchgate" title=ResearchGate type=Button></i></a><a href=https://github.com/itf/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://www.instagram.com/ivan_af_/ target=_blank title=Instagram><i class="svg instagram" title=Instagram type=Button></i></a></div></nav><p class=s90>Â© 2023 Ivan.fyi<p class=s90>Powered by <a href=https://www.getzola.org/ target=_blank>Zola</a> and <a href=https://github.com/jieiku/abridge/ target=_blank>Abridge</a></div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>