<!doctype html><html lang=en-US><head><script integrity=sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1 src=/js/theme.min.js></script><link href="/abridge.css?h=f13d908213237f414e8a" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><script src="/js/abridge.min.js?h=7a008ae54f397de4791e" defer integrity=sha384-jWwR5syXn2tklQhfP11jqm8HMndEVkXtIwiozHBykMgdpgb7hy3apk7Zaj8t7ekR></script><meta content=/ name=base><link title="Ivan.fyi Atom/RSS Feed" href=/atom.xml rel=alternate type=application/atom+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Automatic Latex Fragment Toggling in org-mode | Ivan.fyi</title><meta content="Ivan Tadeu Ferreira Antunes Filho" name=author><meta content=Ivan.fyi name=copyright><meta content="Ivan Tadeu Ferreira Antunes Filho, software engineer in Cambridge, Massachussets, Boston Area" name=description><link href=/automatic-latex-fragment-toggling-in-org-mode.html rel=canonical><meta content="Ivan Tadeu Ferreira Antunes Filho, Ivan Antunes Filho, Software Engineer, Backend, Rust, Scala, Elisp" name=keywords><meta content=/automatic-latex-fragment-toggling-in-org-mode.html property=og:url><meta content=/automatic-latex-fragment-toggling-in-org-mode.html name=twitter:url><meta content="Ivan Tadeu Ferreira Antunes Filho, software engineer in Cambridge, Massachussets, Boston Area" property=og:description><meta content="Ivan Tadeu Ferreira Antunes Filho, software engineer in Cambridge, Massachussets, Boston Area" name=twitter:description><meta content="Automatic Latex Fragment Toggling in org-mode | Ivan.fyi" property=og:title><meta content="Automatic Latex Fragment Toggling in org-mode | Ivan.fyi" name=twitter:title><meta content=summary name=twitter:card><meta content=Ivan.fyi property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2019-05-25 property=og:updated_time><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><meta content=#333333 name=theme-color><meta content=#333333 name=msapplication-TileColor><link href=/manifest.json rel=manifest><link color=#ff9900 href=/safari-pinned-tab.svg rel=mask-icon><link href=/favicon.svg rel=icon type=image/svg+xml><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon sizes=16x16 type=image/png><noscript><link href=/nojs.css rel=stylesheet></noscript><body><header><nav><div><h1><a href=/>Ivan.fyi</a></h1></div><div><a href=/about.html> About </a><a href=/archive/> Posts </a><a href=/portfolio.html> Portfolio </a><a href=/resume.html> Resume </a><i class="js svgs adjust" id=mode type=reset></i></div><div><form autocomplete=off class=js id=searchbox name=goSearch><div class=searchd><input id=searchinput placeholder=Search title=Search><button class=si title=Search>⌕</button></div><div class=results><div id=suggestions></div></div></form></div></nav><hr></header><main><article><h1><a href=/automatic-latex-fragment-toggling-in-org-mode.html>Automatic Latex Fragment Toggling in org-mode</a></h1><span class=s95>May 25, 2019<span class=hpad> </span> Updated: May 25, 2019<span class=hpad> </span> #<a href=/archive/#blog>blog</a> </span><p>Automatic toggle latex fragments in orgmode when point is in them.<p>I found a solution by <a href=http://slumpy.org/blog/2017-02-01-automatic-latex-preview-in-org-mode/>Konstantin Kliakhandler</a>, based on a <a href=http://kitchingroup.cheme.cmu.edu/blog/2015/10/09/Automatic-latex-image-toggling-when-cursor-is-on-a-fragment/>solution premade by John Kitchin</a>.<p>The code worked fine, however, it was fairly slow, and sometimes it would issue too many commands at once (for example, when it was scrolling).<p>Therefore, I decided to improve it and make it faster!<p>The first thing I did was to add a <code>while-no-input</code> to the beginning of the code, so that it can be interrupted with user input. The second thing was to add a <code>(run-with-idle-timer 0.05 nil</code> This adds a delay of .05 seconds before displaying or removing the image. This is particularly useful when scrolling, because, together with the <code>while-no-input</code> it stops the function from running multiple times while you scroll, or move around the text quickly, or when you take multiple actions that take less than 0.05 seconds.<p>At last, I improved the performance considerably by using the trick I learned from <a href=https://github.com/Fuco1/org-inline-image/blob/master/org-inline-image.el>org-inline-image package</a>, i.e that we can get the overlay at point and filter it by a specific property. This way instead of going through a potentially very large list of overlays, we make use of a function that was implemented in C, which is likely much faster, and we only have to go through all the overlays that are defined at point, which are likely much fewer than the number of overlays on the buffer.<p>At last I decided to byte compile the function, because, why not? It will be run at the end of every input anyway.<p>Putting this all together:<pre class="language-el z-code" data-lang=el><code class=language-el data-lang=el><span class="z-source z-lisp">    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">defvar</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span> <span class="z-constant z-language z-lisp">nil</span>
      <span class="z-string z-quoted z-double z-lisp"><span class="z-punctuation z-definition z-string z-begin z-lisp">"</span>Holds last fragment/environment you were on.<span class="z-punctuation z-definition z-string z-end z-lisp">"</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-function z-lisp"><span class="z-storage z-type z-function-type z-lisp">defun</span> <span class="z-entity z-name z-function z-lisp">my</span></span><span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">get</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>current<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
      <span class="z-string z-quoted z-double z-lisp"><span class="z-punctuation z-definition z-string z-begin z-lisp">"</span>Return the overlay associated with the image under point.<span class="z-punctuation z-definition z-string z-end z-lisp">"</span></span>
      <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">car</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>select <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-comparison z-lisp">eq</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>overlay<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">get</span> it 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>overlay<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>type<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span> 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>overlay<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>overlays<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>at <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>point<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-function z-lisp"><span class="z-storage z-type z-function-type z-lisp">defun</span> <span class="z-entity z-name z-function z-lisp">my</span></span><span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>in<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>p <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
        <span class="z-string z-quoted z-double z-lisp"><span class="z-punctuation z-definition z-string z-begin z-lisp">"</span>Return the point where the latex fragment begins, if inside
      a latex fragment. Else return false<span class="z-punctuation z-definition z-string z-end z-lisp">"</span></span>
        <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">let</span><span class="z-keyword z-operator z-arithmetic z-lisp">*</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>el <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>element<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>context<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
               <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>el<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>type <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">car</span> el<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
          <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">and</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">or</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-comparison z-lisp">eq</span> 'latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment el<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>type<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-comparison z-lisp">eq</span> 'latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>environment el<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>type<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
              <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>element<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>property :begin el<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-function z-lisp"><span class="z-storage z-type z-function-type z-lisp">defun</span> <span class="z-entity z-name z-function z-lisp">org-latex-fragment-toggle-auto</span></span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
      <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; Wait for the s
</span>      <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>interactive<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
      <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">while</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>no<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>input 
        <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>run<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-keyword z-control z-lisp">with</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>idle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>timer <span class="z-constant z-numeric z-lisp">0.05</span> <span class="z-constant z-language z-lisp">nil</span> 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>helper<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-function z-lisp"><span class="z-storage z-type z-function-type z-lisp">defun</span> <span class="z-entity z-name z-function z-lisp">org-latex-fragment-toggle-helper</span></span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
        <span class="z-string z-quoted z-double z-lisp"><span class="z-punctuation z-definition z-string z-begin z-lisp">"</span>Toggle a latex fragment image <span class="z-punctuation z-definition z-string z-end z-lisp">"</span></span>
        <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>condition<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-keyword z-control z-lisp">case</span> <span class="z-constant z-language z-lisp">nil</span>
            <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">and</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-comparison z-lisp">eq</span> 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>mode major<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>mode<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                 <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">let</span><span class="z-keyword z-operator z-arithmetic z-lisp">*</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>begin <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>my<span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>in<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>p<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	       <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">cond</span>
    	        <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; were on a fragment and now on a new fragment
</span>    	        <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">and</span>
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; fragment we were on
</span>    	          org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span>
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; and are on a fragment now
</span>                      begin
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; but not on the last one this is a little tricky. as you edit the
</span>    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; fragment, it is not equal to the last one. We use the begin
</span>    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; property which is less likely to change for the comparison.
</span>    	          <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">not</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-comparison z-lisp">=</span> begin
    		          org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	         <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; go back to last one and put image back
</span>    	         <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>save<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>excursion
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>goto<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">char</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">when</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>my<span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>in<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>p<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	           <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; now remove current imagea
</span>                       <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>goto<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">char</span> begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">let</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>ov <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>my<span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">get</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>current<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	             <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">when</span> ov
    	               <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">delete</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>overlay ov<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	           <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; and save new fragment
</span>    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">setq</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span> begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                    
    	        <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; were on a fragment and now are not on a fragment
</span>    	        <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">and</span>
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; not on a fragment now
</span>    	          <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">not</span> begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; but we were on one
</span>    	          org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	         <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; put image back on
</span>    	         <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>save<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>excursion
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>goto<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">char</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">when</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>my<span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>in<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>p<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                     
    	         <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; unset last fragment
</span>    	         <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">setq</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span> <span class="z-constant z-language z-lisp">nil</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                    
    	        <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; were not on a fragment, and now are
</span>    	        <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">and</span>
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; we were not one one
</span>    	          <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">not</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	          <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; but now we are
</span>    	          begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                     <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>save<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>excursion
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>goto<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">char</span> begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                       <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; remove image
</span>    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">let</span> <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>ov <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>my<span class="z-keyword z-operator z-arithmetic z-lisp">/</span>org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">get</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>current<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	             <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-control z-lisp">when</span> ov
    	               <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">delete</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span>overlay ov<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    	           <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">setq</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span> begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                    <span class="z-comment z-line z-semicolon z-lisp"><span class="z-punctuation z-definition z-comment z-lisp">;</span>; else not on a fragment
</span>                    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-keyword z-operator z-logical z-lisp">not</span> begin<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
                     <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">setq</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">last</span> <span class="z-constant z-language z-lisp">nil</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
          <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">error</span> <span class="z-constant z-language z-lisp">nil</span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    
    
    
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span>add<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>hook 'post<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>command<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>hook 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>auto<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">setq</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>helper <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">byte</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">compile</span> 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>helper<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
    <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">setq</span> org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>auto <span class="z-meta z-group z-lisp"><span class="z-punctuation z-definition z-group z-begin z-lisp">(</span><span class="z-support z-function z-lisp">byte</span><span class="z-keyword z-operator z-arithmetic z-lisp">-</span><span class="z-support z-function z-lisp">compile</span> 'org<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>latex<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>fragment<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>toggle<span class="z-keyword z-operator z-arithmetic z-lisp">-</span>auto<span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span><span class="z-punctuation z-definition z-group z-end z-lisp">)</span></span>
</span></code></pre><p>And here is an example! <img alt=img src=/./gif/Screencast-2019-05-25T054725-0400.gif><nav><div><a href=/animating-gifs-in-orgmode.html>‹ Animating gifs in orgmode</a></div><div><a href=/magically-setup-emacsclient.html> Magically setup emacsclient ›</a></div></nav></article></main><footer><hr><div class=c><nav><div><a title="Ivan.fyi Atom/RSS Feed" href=/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="Ivan.fyi Atom/RSS Feed" type=Button></i></a><a class="js m-protected" href=#aXRhZGV1ZmFAZ21haWwuY29t target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://www.linkedin.com/in/ivan-tadeu-ferreira-antunes-filho-8b2b0950/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://www.researchgate.net/profile/Ivan-Tadeu-Ferreira-Antunes-Filho/ target=_blank title=ResearchGate><i class="svg researchgate" title=ResearchGate type=Button></i></a><a href=https://github.com/itf/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://www.instagram.com/ivan_af_/ target=_blank title=Instagram><i class="svg instagram" title=Instagram type=Button></i></a></div></nav><p class=s90>© 2023 Ivan.fyi<p class=s90>Powered by <a href=https://www.getzola.org/ target=_blank>Zola</a> and <a href=https://github.com/jieiku/abridge/ target=_blank>Abridge</a></div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>